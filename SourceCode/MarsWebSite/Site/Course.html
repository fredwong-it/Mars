<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>From Zero to Hero: Cloud and more</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.9/css/all.css" integrity="sha384-5SOiIsAziJl6AWe0HWRKTXlfcSHKmYV4RBF18PPJ173Kzn7jzMyFuTtk8JA7QQG1" crossorigin="anonymous">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>

    <style>
        .fileImage {
            height: 80px;
            width: 80px;
        }

        i {
            font-size: 20px;
            vertical-align: middle;
        }

        .floating-box {
            display: inline-block;
        }
    </style>
    <base href="/api/">
   
</head>
<body>
    
    <div class="container" ng-app="myApp" ng-controller="customersCtrl">
        <div class="row">
            <div class="col-xs-10 col-xs-offset-1">
                <h1>From Zero to Hero!</h1>
                <div>{{user}}</div>
            </div>
        </div>

        <div class="row">
            <div class="col-xs-1 col-xs-offset-1">
                <img class="fileImage" src="site/img/{{root}}.png" />  
            </div>
            <div class="col-xs-9">
                <h3>{{course}}</h3>
            </div>
        </div>

        <div class="row">
            <div class="col-xs-1 col-xs-offset-1" style="width:50px">
                <a href="index" target="_self"> <i class="fas fa-home"></i> </a>
            </div>
             
            <div id="breadcrumb" class="col-xs-7">start</div>
        </div>
        <div class="row" ng-repeat="x in dirOrFiles | orderBy : ['Type', 'Name'] ">
                <ngif ng-if="x.Type == 'directory'">
                    <div class="col-xs-1 col-xs-offset-1 col-xs-auto" style="width:30px">
                        <i class="fas fa-folder-open"></i>
                    </div>
                    <div class="col-xs-5">
                        <a class="floating-box" ng-click="getSubfolders(x.Path)"><h4> {{x.Name}}  </h4></a><img class="floating-box" src="site/img/{{x.IsRecent}}.png"  />
                    </div>
                    <div class="col-xs-2" style="text-align:left">
                        <h4> {{x.LastModifiedDate}}  </h4>
                    </div>
                    <div class="col-xs-1">

                    </div>
                </ngif>
                <ngif ng-if="x.Type == 'file'">
                    <div class="col-xs-1 col-xs-offset-1 col-xs-auto" style="width:30px">
                        <i class="far fa-file" ></i> 
                    </div>
                    <div class="col-xs-5">
                        <a class="floating-box" href="getfile/{{x.Path}}/{{x.Name}}" target="_blank"><h4>{{x.Name}}</h4></a>&nbsp;&nbsp; <img class="floating-box" src="site/img/{{x.IsRecent}}.png" /> 
                    </div>
                    <div class="col-xs-2" style="text-align:left">
                        <h4> {{x.LastModifiedDate}}  </h4>
                    </div>
                    <div class="col-xs-2">
                        <h4> {{x.Size}}  </h4>
                    </div>
                </ngif>
            </div>
        </div> 
    
    <script>
         var app = angular.module('myApp', []);
         app.config(['$locationProvider', function ($locationProvider) {
             $locationProvider.html5Mode(true);
         }]);

         app.controller('customersCtrl', function ($scope, $http, $location,$compile) {
             $http.get("User").then(function (response) {
                 $scope.user = "Hello " + response.data + "!";
             });

             $scope.course = $location.search()['course'];
             var path = $location.search()['path'];
             $scope.path = path;
             $scope.root = getRoot(path);
             $scope.folders = getFolders(path);
             
             $http.get("Services/" + path).then(function (response) {
                 $scope.dirOrFiles = JSON.parse(response.data);                
             });

             $scope.getSubfolders = function (path) {
                $http.get("Services/" + path).then(function (response) {
                    $scope.dirOrFiles = JSON.parse(response.data);
                 });
                 appendBreadcrumb($scope, $compile, path);
             } 

             appendBreadcrumb($scope, $compile, path);
         });


         function getRoot(path) {
             var folders = getFolders(path);
             return folders[0];
         }

         function getFolders(path) {
             var folders = path.split("-");
             return folders;
         }

         function appendBreadcrumb(scope,compile, path) {
             var course = scope.course;
             var folders = path.split("-");
             
             //Get the element that we want to append to
             var divRoot = angular.element(document.getElementById("breadcrumb"));
             divRoot.empty();
             var currentLink = folders[0];
             for (i = 0; i < folders.length; i++) {
                 var linkHtml;
                 if (i < folders.length - 1 ) { 
                    linkHtml = "<a ng-click='getSubfolders(&apos;" + currentLink + "&apos;)'>" + folders[i] + " / " + "</a> ";
                 } else {
                     linkHtml = "<span>" + folders[i] + "</span>";
                 }
                 var subLink = angular.element(linkHtml);
                 divRoot.append(subLink);

                 currentLink = currentLink + "-" + folders[i + 1];                 
             }
             compile(divRoot.contents())(scope);
         }
    </script>
</body>

</html>
